name: Nightly

on:
  schedule:
    - cron: '0 3 * * *'  # 3 AM UTC
  workflow_dispatch:  # Allow manual trigger

jobs:
  slow-tests:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: "3.12"

      - name: Install dependencies
        run: pip install -e ".[dev]"

      - name: Run slow tests
        run: pytest -m "slow" -v --tb=short

  full-pipeline:
    runs-on: ubuntu-latest
    needs: slow-tests
    steps:
      - uses: actions/checkout@v4

      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: "3.12"

      - name: Install dependencies
        run: pip install -e ".[dev]"

      - name: Generate small test dataset
        run: python -m data.scripts.generate_dataset --world all --n_samples 1000 --seed 42 --output datasets/test/

      - name: Validate dataset
        run: python -m data.scripts.validate_dataset --path datasets/test/
