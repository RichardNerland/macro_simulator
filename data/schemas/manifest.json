{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://macro-simulator/schemas/manifest.json",
  "title": "Dataset Manifest",
  "description": "Metadata schema for Universal Macro Emulator datasets",
  "type": "object",
  "required": ["version", "created_at", "git_hash", "simulators", "splits", "rng_seeds"],
  "properties": {
    "version": {
      "type": "string",
      "description": "Dataset version in semver format",
      "pattern": "^\\d+\\.\\d+\\.\\d+$",
      "examples": ["1.0.0"]
    },
    "created_at": {
      "type": "string",
      "description": "ISO 8601 timestamp of dataset creation",
      "format": "date-time",
      "examples": ["2025-12-23T00:00:00Z"]
    },
    "git_hash": {
      "type": "string",
      "description": "Git commit hash or 'unknown' if not in git repo",
      "pattern": "^([0-9a-f]{7,40}|unknown)$",
      "examples": ["abc1234", "unknown"]
    },
    "simulators": {
      "type": "object",
      "description": "Dictionary of simulator configurations, keyed by world_id",
      "patternProperties": {
        "^[a-z_]+$": {
          "type": "object",
          "required": ["n_samples", "param_manifest", "shock_manifest", "obs_manifest", "config_hash"],
          "properties": {
            "n_samples": {
              "type": "integer",
              "description": "Number of samples generated for this simulator",
              "minimum": 0,
              "examples": [100000]
            },
            "param_manifest": {
              "type": "object",
              "description": "Parameter metadata for this simulator",
              "required": ["names", "units", "bounds", "defaults"],
              "properties": {
                "names": {
                  "type": "array",
                  "description": "Parameter names",
                  "items": {"type": "string"},
                  "examples": [["beta", "sigma", "phi_pi"]]
                },
                "units": {
                  "type": "array",
                  "description": "Physical units for each parameter",
                  "items": {"type": "string"},
                  "examples": [["-", "-", "-"]]
                },
                "bounds": {
                  "type": "array",
                  "description": "Parameter bounds [lower, upper] for each parameter",
                  "items": {
                    "type": "array",
                    "minItems": 2,
                    "maxItems": 2,
                    "items": {"type": "number"}
                  },
                  "examples": [[[0.985, 0.995], [0.5, 2.5]]]
                },
                "defaults": {
                  "type": "array",
                  "description": "Default values for each parameter",
                  "items": {"type": "number"},
                  "examples": [[0.99, 1.0, 1.5]]
                },
                "priors": {
                  "type": "array",
                  "description": "Prior specifications (optional)",
                  "items": {
                    "type": "object",
                    "properties": {
                      "type": {"type": "string"},
                      "params": {"type": "object"}
                    }
                  }
                }
              }
            },
            "shock_manifest": {
              "type": "object",
              "description": "Shock metadata for this simulator",
              "required": ["names", "n_shocks", "sigma"],
              "properties": {
                "names": {
                  "type": "array",
                  "description": "Shock names",
                  "items": {"type": "string"},
                  "examples": [["monetary", "technology", "cost_push"]]
                },
                "n_shocks": {
                  "type": "integer",
                  "description": "Number of shock types",
                  "minimum": 1,
                  "examples": [3]
                },
                "sigma": {
                  "type": "array",
                  "description": "Standard deviation of each shock",
                  "items": {"type": "number", "minimum": 0},
                  "examples": [[0.001, 0.005, 0.001]]
                },
                "default_size": {
                  "type": "number",
                  "description": "Default shock size in std dev units",
                  "minimum": 0,
                  "default": 1.0
                }
              }
            },
            "obs_manifest": {
              "type": "object",
              "description": "Observable metadata for this simulator",
              "required": ["canonical_names", "extra_names", "n_canonical", "n_extra"],
              "properties": {
                "canonical_names": {
                  "type": "array",
                  "description": "Always [output, inflation, rate]",
                  "items": {"type": "string"},
                  "minItems": 3,
                  "maxItems": 3,
                  "examples": [["output", "inflation", "rate"]]
                },
                "extra_names": {
                  "type": "array",
                  "description": "Simulator-specific observables (up to 10)",
                  "items": {"type": "string"},
                  "maxItems": 10,
                  "examples": [["consumption", "investment"]]
                },
                "n_canonical": {
                  "type": "integer",
                  "description": "Number of canonical observables (always 3)",
                  "const": 3
                },
                "n_extra": {
                  "type": "integer",
                  "description": "Number of extra observables",
                  "minimum": 0,
                  "maximum": 10
                }
              }
            },
            "config_hash": {
              "type": "string",
              "description": "Hash of simulator configuration for reproducibility",
              "pattern": "^[0-9a-f]{8,64}$",
              "examples": ["def45678"]
            }
          }
        }
      },
      "minProperties": 1
    },
    "splits": {
      "type": "object",
      "description": "Train/val/test split configuration",
      "required": ["train", "val", "test_interpolation"],
      "properties": {
        "train": {
          "type": "object",
          "required": ["fraction", "seed"],
          "properties": {
            "fraction": {
              "type": "number",
              "minimum": 0,
              "maximum": 1,
              "examples": [0.8]
            },
            "seed": {
              "type": "integer",
              "examples": [42]
            },
            "algorithm": {
              "type": "string",
              "description": "Split algorithm identifier",
              "examples": ["random_interpolation"]
            }
          }
        },
        "val": {
          "type": "object",
          "required": ["fraction", "seed"],
          "properties": {
            "fraction": {"type": "number", "minimum": 0, "maximum": 1},
            "seed": {"type": "integer"}
          }
        },
        "test_interpolation": {
          "type": "object",
          "required": ["fraction", "seed"],
          "properties": {
            "fraction": {"type": "number", "minimum": 0, "maximum": 1},
            "seed": {"type": "integer"}
          }
        },
        "test_extrapolation_slice": {
          "type": "object",
          "properties": {
            "fraction": {"type": "number", "minimum": 0, "maximum": 1},
            "seed": {"type": "integer"},
            "algorithm": {
              "type": "string",
              "description": "Extrapolation slice algorithm",
              "examples": ["slice_predicate"]
            }
          }
        },
        "test_extrapolation_corner": {
          "type": "object",
          "properties": {
            "fraction": {"type": "number", "minimum": 0, "maximum": 1},
            "seed": {"type": "integer"},
            "algorithm": {
              "type": "string",
              "description": "Extrapolation corner algorithm",
              "examples": ["corner_extremes"]
            }
          }
        }
      }
    },
    "rng_seeds": {
      "type": "object",
      "description": "Random number generator seed configuration",
      "required": ["global", "per_sample"],
      "properties": {
        "global": {
          "type": "integer",
          "description": "Global seed for experiment-level reproducibility",
          "examples": [42]
        },
        "per_sample": {
          "type": "boolean",
          "description": "Whether per-sample seeds are derived from global seed",
          "examples": [true]
        },
        "derivation_algorithm": {
          "type": "string",
          "description": "Algorithm for deriving per-sample seeds",
          "examples": ["global_seed + sample_index"]
        }
      }
    },
    "T": {
      "type": "integer",
      "description": "Trajectory length (optional, defaults vary)",
      "minimum": 1,
      "examples": [200]
    },
    "H": {
      "type": "integer",
      "description": "IRF horizon (optional, default 40)",
      "minimum": 1,
      "examples": [40, 80]
    },
    "notes": {
      "type": "string",
      "description": "Optional notes about this dataset"
    }
  },
  "additionalProperties": false
}
