# Universal Emulator - LOWO (Leave-One-World-Out): Exclude VAR
#
# This config trains the universal emulator on all worlds EXCEPT var,
# then evaluates transfer performance on the held-out var world.
#
# Training worlds: lss, nk, rbc, switching, zlb
# Held-out world: var

model:
  type: universal

  # Embedding dimensions
  world_embed_dim: 32          # Dimension for world ID embedding
  theta_embed_dim: 64          # Dimension for parameter embeddings
  shock_embed_dim: 16          # Dimension for shock token embedding
  eps_embed_dim: 32            # Dimension for shock sequence embedding

  # Architecture
  trunk_dim: 256               # Hidden dimension for main trunk
  trunk_layers: 4              # Number of transformer/MLP layers in trunk
  n_heads: 4                   # Number of attention heads (if using transformer)
  dropout: 0.1                 # Dropout rate

  # Output
  H: 40                        # IRF horizon length
  n_obs: 3                     # Number of observables (output, inflation, rate)

  # Architecture variant
  encoder_type: transformer    # "transformer", "mlp", or "gru"

training:
  # Information regime
  regime: A

  # Optimization
  batch_size: 128
  lr: 1.0e-4
  weight_decay: 0.01
  grad_clip: 1.0

  # Schedule
  epochs: 100
  warmup_epochs: 5
  scheduler: cosine            # "cosine" or "none"

  # Early stopping
  patience: 10
  min_delta: 1.0e-4

  # Checkpointing
  checkpoint_dir: runs/lowo_exclude_var
  save_every_n_epochs: 10
  save_best: true

  # Logging
  log_every_n_steps: 50
  use_wandb: false
  wandb_project: macro-emulator
  wandb_run_name: lowo_exclude_var

loss:
  # Loss function type
  type: multi_horizon          # "multi_horizon" or "combined"

  # Horizon weighting
  weight_scheme: exponential   # "uniform", "exponential", or "impact"
  tau: 20.0                    # Decay parameter for exponential weighting
  impact_length: 5             # Length of impact period for impact weighting

  # Per-variable weights (optional)
  # If null, all variables weighted equally
  # Format: [weight_output, weight_inflation, weight_rate]
  per_variable_weights: null

  # Smoothness regularization
  smoothness_lambda: 0.01      # Coefficient for smoothness penalty (0.0 = disabled)

data:
  # Dataset path
  dataset_path: datasets/v1.0/

  # Which simulator families to include (LOWO: exclude var)
  worlds:
    - lss
    - nk
    - rbc
    - switching
    - zlb

  # Held-out world for LOWO evaluation
  held_out_world: var

  # Data splits
  train_split: train
  val_split: val
  test_split: test

  # Dataloader settings
  num_workers: 4
  pin_memory: true
  shuffle_train: true

# Reproducibility
seed: 42

# Compute
device: cuda  # "cuda" or "cpu"
